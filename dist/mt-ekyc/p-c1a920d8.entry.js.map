{"version":3,"names":["cameraPreviewCss","CameraPreview","componentDidLoad","this","play","stream","navigator","mediaDevices","getUserMedia","video","width","min","ideal","max","height","facingMode","camera","srcObject","takePhoto","canvas","document","createElement","resolutionMultiplier","clientWidth","clientHeight","videoAspectRatio","videoWidth","videoHeight","canvasAspectRatio","sx","sy","sw","sh","getContext","drawImage","base64Image","toDataURL","photo","src","photoTaked","emit","render","h","class","ref","el","onClick"],"sources":["src/components/camera-preview/camera-preview.css?tag=camera-preview&encapsulation=shadow","src/components/camera-preview/camera-preview.tsx"],"sourcesContent":[":host {\n  display: block;\n}\n\n.video-container {\n  position: relative;\n  width: 100%;\n  padding-top: 62%;\n  overflow: hidden;\n  border-radius: 8px;\n}\n\nvideo {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n  border-radius: 8px;\n}\n\nimg {\n  width: 100%;\n  border-radius: 8px;\n}\n","import { Component, h, Event, EventEmitter } from '@stencil/core';\n\n@Component({\n  tag: 'camera-preview',\n  styleUrl: 'camera-preview.css',\n  shadow: true,\n})\nexport class CameraPreview {\n  camera: HTMLVideoElement;\n  photo: HTMLImageElement;\n\n  @Event() photoTaked: EventEmitter<string>;\n\n  videoDevices: MediaDeviceInfo[];\n\n  componentDidLoad() {\n    this.play();\n  }\n\n  async play() {\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: {\n        width: {\n          min: 1280,\n          ideal: 1920,\n          max: 2560,\n        },\n        height: {\n          min: 720,\n          ideal: 1080,\n          max: 1440,\n        },\n        facingMode: 'environment',\n      },\n    });\n\n    this.camera.srcObject = stream;\n\n    await this.camera.play();\n  }\n\n  takePhoto() {\n    const canvas = document.createElement('canvas');\n\n    const resolutionMultiplier = 3;\n\n    canvas.width = this.camera.clientWidth * resolutionMultiplier;\n    canvas.height = this.camera.clientHeight * resolutionMultiplier;\n\n    const videoAspectRatio = this.camera.videoWidth / this.camera.videoHeight;\n    const canvasAspectRatio = canvas.width / canvas.height;\n\n    let sx: number, sy: number, sw: number, sh: number;\n\n    if (videoAspectRatio > canvasAspectRatio) {\n      // El video es más ancho, recorta en la alturas\n      sw = this.camera.videoHeight * canvasAspectRatio;\n      sh = this.camera.videoHeight;\n      sx = (this.camera.videoWidth - sw) / 2;\n      sy = 0;\n    } else {\n      // El video es más alto o tiene el mismo aspect ratio, recorta en la anchura\n      sw = this.camera.videoWidth;\n      sh = this.camera.videoWidth / canvasAspectRatio;\n      sx = 0;\n      sy = (this.camera.videoHeight - sh) / 2;\n    }\n\n    canvas.getContext(\"2d\").drawImage(this.camera, sx, sy, sw, sh, 0, 0, canvas.width, canvas.height);\n\n    // canvas.getContext('2d').drawImage(this.camera, 0, 0);\n\n    const base64Image = canvas.toDataURL('image/webp');\n\n    this.photo.src = base64Image;\n\n    this.photoTaked.emit(base64Image);\n  }\n\n  render() {\n    return (\n      <div>\n        <div class=\"video-container\">\n          <video ref={el => (this.camera = el as HTMLVideoElement)}></video>\n        </div>\n\n        <img ref={el => (this.photo = el as HTMLImageElement)} />\n\n        <button onClick={() => this.takePhoto()}>Take photo</button>\n      </div>\n    );\n  }\n}\n"],"mappings":"kDAAA,MAAMA,EAAmB,uP,MCOZC,EAAa,M,gEAQxB,gBAAAC,GACEC,KAAKC,M,CAGP,UAAMA,GACJ,MAAMC,QAAeC,UAAUC,aAAaC,aAAa,CACvDC,MAAO,CACLC,MAAO,CACLC,IAAK,KACLC,MAAO,KACPC,IAAK,MAEPC,OAAQ,CACNH,IAAK,IACLC,MAAO,KACPC,IAAK,MAEPE,WAAY,iBAIhBZ,KAAKa,OAAOC,UAAYZ,QAElBF,KAAKa,OAAOZ,M,CAGpB,SAAAc,GACE,MAAMC,EAASC,SAASC,cAAc,UAEtC,MAAMC,EAAuB,EAE7BH,EAAOT,MAAQP,KAAKa,OAAOO,YAAcD,EACzCH,EAAOL,OAASX,KAAKa,OAAOQ,aAAeF,EAE3C,MAAMG,EAAmBtB,KAAKa,OAAOU,WAAavB,KAAKa,OAAOW,YAC9D,MAAMC,EAAoBT,EAAOT,MAAQS,EAAOL,OAEhD,IAAIe,EAAYC,EAAYC,EAAYC,EAExC,GAAIP,EAAmBG,EAAmB,CAExCG,EAAK5B,KAAKa,OAAOW,YAAcC,EAC/BI,EAAK7B,KAAKa,OAAOW,YACjBE,GAAM1B,KAAKa,OAAOU,WAAaK,GAAM,EACrCD,EAAK,C,KACA,CAELC,EAAK5B,KAAKa,OAAOU,WACjBM,EAAK7B,KAAKa,OAAOU,WAAaE,EAC9BC,EAAK,EACLC,GAAM3B,KAAKa,OAAOW,YAAcK,GAAM,C,CAGxCb,EAAOc,WAAW,MAAMC,UAAU/B,KAAKa,OAAQa,EAAIC,EAAIC,EAAIC,EAAI,EAAG,EAAGb,EAAOT,MAAOS,EAAOL,QAI1F,MAAMqB,EAAchB,EAAOiB,UAAU,cAErCjC,KAAKkC,MAAMC,IAAMH,EAEjBhC,KAAKoC,WAAWC,KAAKL,E,CAGvB,MAAAM,GACE,OACEC,EAAA,WACEA,EAAA,OAAKC,MAAM,mBACTD,EAAA,SAAOE,IAAKC,GAAO1C,KAAKa,OAAS6B,KAGnCH,EAAA,OAAKE,IAAKC,GAAO1C,KAAKkC,MAAQQ,IAE9BH,EAAA,UAAQI,QAAS,IAAM3C,KAAKe,aAAW,c"}